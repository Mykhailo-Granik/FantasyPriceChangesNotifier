package retriever.fantasyfootballhub;

import common.Player;
import common.Position;
import org.junit.jupiter.api.Test;

import java.util.List;

import static org.junit.jupiter.api.Assertions.*;

public class FantasyFootballHubRetrieverTest {

    @Test
    public void shouldRetrievePlayers() {
        FantasyFootballHubRetriever retriever = new FantasyFootballHubRetriever(new TestingFantasyFootballHubClient());
        assertEquals(
                List.of(
                        new Player("Salah", "Liverpool", Position.MID, 12.7, 95.2),
                        new Player("De Bruyne", "Man City", Position.MID, 12.3, -98.97)
                ),
                retriever.retrieve()
        );
    }

    private static class TestingFantasyFootballHubClient extends FantasyFootballHubClient {
        @Override
        public String playerData() {
            return "[{\"code\":118748,\"webName\":\"Salah\",\"searchTerm\":\"Salah Mohamed Salah LIV Liverpool\",\"team\":{\"code\":14,\"name\":\"Liverpool\",\"codeName\":\"LIV\"},\"season\":2022,\"data\":{\"status\":\"a\",\"nowCost\":127,\"teamCode\":14,\"priceInfo\":{\"Code\":118748,\"Team\":\"Liverpool\",\"Value\":12.7,\"Status\":\"a\",\"Target\":95.21718918918921,\"Position\":\"MID\",\"Ownership\":29.2,\"PlayerName\":\"Salah\",\"RateOfChange\":234854},\"positionId\":3,\"predictions\":[{\"gw\":26,\"opp\":[[\"MUN\",\"Man Utd (H)\",4]],\"capt\":1,\"xmins\":90,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":5.70329301647391},{\"gw\":27,\"opp\":[[\"bou\",\"Bournemouth (A)\",2]],\"capt\":1,\"xmins\":90,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":7.41117974476821},{\"gw\":28,\"opp\":[[\"FUL\",\"Fulham (H)\",2]],\"capt\":1,\"xmins\":90,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":6.87378221077008},{\"gw\":29,\"opp\":[[\"che\",\"Chelsea (A)\",4],[\"mci\",\"Man City (A)\",5]],\"capt\":1,\"xmins\":180,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":8.26340428201649},{\"gw\":30,\"opp\":[[\"ARS\",\"Arsenal (H)\",4]],\"capt\":1,\"xmins\":90,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":4.95774322687324},{\"gw\":31,\"opp\":[[\"lee\",\"Leeds (A)\",2]],\"capt\":1,\"xmins\":90,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":6.58145694041823},{\"gw\":32,\"opp\":[[\"NFO\",\"Nott'm Forest (H)\",2]],\"capt\":1,\"xmins\":90,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":7.71834831405078},{\"gw\":33,\"opp\":[[\"whu\",\"West Ham (A)\",3]],\"capt\":1,\"xmins\":90,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":5.353771002494},{\"gw\":34,\"opp\":[[\"TOT\",\"Spurs (H)\",4]],\"capt\":1,\"xmins\":90,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":6.12975938815005},{\"gw\":35,\"opp\":[[\"BRE\",\"Brentford (H)\",3]],\"capt\":1,\"xmins\":90,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":6.63363996930973},{\"gw\":36,\"opp\":[[\"lei\",\"Leicester (A)\",3]],\"capt\":1,\"xmins\":90,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":6.53097327211551},{\"gw\":37,\"opp\":[[\"AVL\",\"Aston Villa (H)\",3]],\"capt\":1,\"xmins\":90,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":6.69812296664381},{\"gw\":38,\"opp\":[[\"sou\",\"Southampton (A)\",3]],\"capt\":1,\"xmins\":90,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":6.90337683916151}],\"teamCodeName\":\"LIV\",\"next_gw_xmins\":90,\"prediction4GW\":28.251659254028688,\"formatted_cost\":\"12.7\",\"weighted_prediction\":18.283973938592915},\"fpl\":{\"id\":283,\"bps\":298,\"code\":118748,\"form\":\"3.8\",\"news\":\"\",\"team\":12,\"bonus\":13,\"photo\":\"118748.jpg\",\"saves\":0,\"starts\":22,\"status\":\"a\",\"threat\":\"992.0\",\"assists\":6,\"ep_next\":\"4.3\",\"ep_this\":\"8.6\",\"minutes\":1956,\"special\":false,\"now_cost\":127,\"web_name\":\"Salah\",\"form_rank\":41,\"ict_index\":\"200.2\",\"influence\":\"498.6\",\"own_goals\":0,\"red_cards\":0,\"team_code\":14,\"creativity\":\"511.4\",\"first_name\":\"Mohamed\",\"news_added\":null,\"value_form\":\"0.3\",\"second_name\":\"Salah\",\"threat_rank\":4,\"clean_sheets\":7,\"element_type\":3,\"event_points\":0,\"goals_scored\":8,\"in_dreamteam\":false,\"saves_per_90\":0,\"squad_number\":null,\"total_points\":122,\"transfers_in\":4522757,\"value_season\":\"9.6\",\"yellow_cards\":0,\"now_cost_rank\":1,\"selected_rank\":10,\"starts_per_90\":1.01,\"transfers_out\":7341473,\"expected_goals\":\"10.12\",\"form_rank_type\":15,\"goals_conceded\":27,\"ict_index_rank\":6,\"influence_rank\":30,\"penalties_text\":\"\",\"creativity_rank\":19,\"dreamteam_count\":3,\"penalties_order\":2,\"penalties_saved\":0,\"points_per_game\":\"5.5\",\"expected_assists\":\"3.46\",\"penalties_missed\":0,\"threat_rank_type\":1,\"cost_change_event\":0,\"cost_change_start\":-3,\"now_cost_rank_type\":1,\"selected_rank_type\":6,\"transfers_in_event\":3336,\"clean_sheets_per_90\":0.32,\"ict_index_rank_type\":4,\"influence_rank_type\":14,\"selected_by_percent\":\"29.2\",\"transfers_out_event\":3357,\"creativity_rank_type\":14,\"points_per_game_rank\":12,\"direct_freekicks_text\":\"\",\"expected_goals_per_90\":0.47,\"goals_conceded_per_90\":1.24,\"cost_change_event_fall\":0,\"cost_change_start_fall\":3,\"direct_freekicks_order\":null,\"expected_assists_per_90\":0.16,\"expected_goals_conceded\":\"31.13\",\"points_per_game_rank_type\":6,\"expected_goal_involvements\":\"13.61\",\"chance_of_playing_next_round\":null,\"chance_of_playing_this_round\":null,\"expected_goals_conceded_per_90\":1.43,\"expected_goal_involvements_per_90\":0.63,\"corners_and_indirect_freekicks_text\":\"\",\"corners_and_indirect_freekicks_order\":null},\"live\":{\"bps\":0,\"bonus\":0,\"saves\":0,\"starts\":0,\"threat\":\"0.0\",\"assists\":0,\"minutes\":0,\"ict_index\":\"0.0\",\"influence\":\"0.0\",\"own_goals\":0,\"red_cards\":0,\"creativity\":\"0.0\",\"clean_sheets\":0,\"goals_scored\":0,\"in_dreamteam\":false,\"total_points\":0,\"yellow_cards\":0,\"expected_goals\":\"0.00\",\"goals_conceded\":0,\"penalties_saved\":0,\"expected_assists\":\"0.00\",\"penalties_missed\":0,\"expected_goals_conceded\":\"0.00\",\"expected_goal_involvements\":\"0.00\"}},{\"code\":61366,\"webName\":\"De Bruyne\",\"searchTerm\":\"De Bruyne Kevin De Bruyne MCI Man City\",\"team\":{\"code\":43,\"name\":\"Man City\",\"codeName\":\"MCI\"},\"season\":2022,\"data\":{\"status\":\"d\",\"nowCost\":123,\"teamCode\":43,\"priceInfo\":{\"Code\":61366,\"Team\":\"Man City\",\"Value\":12.3,\"Status\":\"d\",\"Target\":-98.97103243243245,\"Position\":\"MID\",\"Ownership\":30.1,\"PlayerName\":\"De Bruyne\",\"RateOfChange\":-208562},\"positionId\":3,\"predictions\":[{\"gw\":26,\"opp\":[[\"NEW\",\"Newcastle (H)\",3]],\"capt\":1,\"xmins\":59,\"status\":\"d\",\"fitness\":0.75,\"predicted_pts\":3.28847570559798},{\"gw\":27,\"opp\":[[\"cry\",\"Crystal Palace (A)\",3]],\"capt\":1,\"xmins\":78,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":5.19717799307515},{\"gw\":28,\"opp\":[[\"WHU\",\"West Ham (H)\",3]],\"capt\":1,\"xmins\":78,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":5.20269566399381},{\"gw\":29,\"opp\":[[\"LIV\",\"Liverpool (H)\",5]],\"capt\":1,\"xmins\":78,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":5.30333716985695},{\"gw\":30,\"opp\":[[\"sou\",\"Southampton (A)\",3]],\"capt\":1,\"xmins\":78,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":5.82767133265881},{\"gw\":31,\"opp\":[[\"LEI\",\"Leicester (H)\",3]],\"capt\":1,\"xmins\":78,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":6.16617826497312},{\"gw\":32,\"opp\":[[\"bha\",\"Brighton (A)\",3]],\"capt\":1,\"xmins\":78,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":4.5444832821315},{\"gw\":33,\"opp\":[[\"ARS\",\"Arsenal (H)\",4]],\"capt\":1,\"xmins\":78,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":4.47215513612603},{\"gw\":34,\"opp\":[[\"ful\",\"Fulham (A)\",2]],\"capt\":1,\"xmins\":78,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":5.30708261223169},{\"gw\":35,\"opp\":[[\"LEE\",\"Leeds (H)\",2]],\"capt\":1,\"xmins\":78,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":6.20997865859667},{\"gw\":36,\"opp\":[[\"eve\",\"Everton (A)\",3]],\"capt\":1,\"xmins\":78,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":5.6543640896751},{\"gw\":37,\"opp\":[[\"CHE\",\"Chelsea (H)\",4]],\"capt\":1,\"xmins\":78,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":4.46661850146426},{\"gw\":38,\"opp\":[[\"bre\",\"Brentford (A)\",3]],\"capt\":1,\"xmins\":78,\"status\":\"a\",\"fitness\":1,\"predicted_pts\":5.14761004942298}],\"teamCodeName\":\"MCI\",\"next_gw_xmins\":59,\"prediction4GW\":18.99168653252389,\"formatted_cost\":\"12.3\",\"weighted_prediction\":12.694089712339863},\"fpl\":{\"id\":301,\"bps\":517,\"code\":61366,\"form\":\"3.6\",\"news\":\"Illness - 75% chance of playing\",\"team\":13,\"bonus\":16,\"photo\":\"61366.jpg\",\"saves\":0,\"starts\":21,\"status\":\"d\",\"threat\":\"500.0\",\"assists\":13,\"ep_next\":\"3.1\",\"ep_this\":\"3.8\",\"minutes\":1860,\"special\":false,\"now_cost\":123,\"web_name\":\"De Bruyne\",\"form_rank\":42,\"ict_index\":\"228.0\",\"influence\":\"636.4\",\"own_goals\":0,\"red_cards\":0,\"team_code\":43,\"creativity\":\"1141.3\",\"first_name\":\"Kevin\",\"news_added\":\"2023-02-21T23:00:07.995590Z\",\"value_form\":\"0.3\",\"second_name\":\"De Bruyne\",\"threat_rank\":28,\"clean_sheets\":7,\"element_type\":3,\"event_points\":0,\"goals_scored\":4,\"in_dreamteam\":true,\"saves_per_90\":0,\"squad_number\":null,\"total_points\":125,\"transfers_in\":6065928,\"value_season\":\"10.2\",\"yellow_cards\":1,\"now_cost_rank\":2,\"selected_rank\":9,\"starts_per_90\":1.02,\"transfers_out\":4987898,\"expected_goals\":\"3.69\",\"form_rank_type\":16,\"goals_conceded\":19,\"ict_index_rank\":3,\"influence_rank\":10,\"penalties_text\":\"\",\"creativity_rank\":2,\"dreamteam_count\":3,\"penalties_order\":3,\"penalties_saved\":0,\"points_per_game\":\"5.4\",\"expected_assists\":\"11.08\",\"penalties_missed\":0,\"threat_rank_type\":15,\"cost_change_event\":0,\"cost_change_start\":3,\"now_cost_rank_type\":2,\"selected_rank_type\":5,\"transfers_in_event\":559,\"clean_sheets_per_90\":0.34,\"ict_index_rank_type\":1,\"influence_rank_type\":4,\"selected_by_percent\":\"30.1\",\"transfers_out_event\":12088,\"creativity_rank_type\":1,\"points_per_game_rank\":14,\"direct_freekicks_text\":\"\",\"expected_goals_per_90\":0.18,\"goals_conceded_per_90\":0.92,\"cost_change_event_fall\":0,\"cost_change_start_fall\":-3,\"direct_freekicks_order\":1,\"expected_assists_per_90\":0.54,\"expected_goals_conceded\":\"15.94\",\"points_per_game_rank_type\":8,\"expected_goal_involvements\":\"14.78\",\"chance_of_playing_next_round\":75,\"chance_of_playing_this_round\":75,\"expected_goals_conceded_per_90\":0.77,\"expected_goal_involvements_per_90\":0.72,\"corners_and_indirect_freekicks_text\":\"\",\"corners_and_indirect_freekicks_order\":2},\"live\":{\"bps\":0,\"bonus\":0,\"saves\":0,\"starts\":0,\"threat\":\"0.0\",\"assists\":0,\"minutes\":0,\"ict_index\":\"0.0\",\"influence\":\"0.0\",\"own_goals\":0,\"red_cards\":0,\"creativity\":\"0.0\",\"clean_sheets\":0,\"goals_scored\":0,\"in_dreamteam\":false,\"total_points\":0,\"yellow_cards\":0,\"expected_goals\":\"0.00\",\"goals_conceded\":0,\"penalties_saved\":0,\"expected_assists\":\"0.00\",\"penalties_missed\":0,\"expected_goals_conceded\":\"0.00\",\"expected_goal_involvements\":\"0.00\"}}]";
        }
    }

}